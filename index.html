<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
  <title>YoCokeController</title>
  <!-- rename as Yo Ordr??? -->

  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>

  <!-- Firebase -->
  <script src="https://cdn.firebase.com/js/client/2.0.4/firebase.js"></script>

  <!-- css -->
	<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
	<link rel="stylesheet" href="style.css">

	<!-- fonts -->
	<link href='http://fonts.googleapis.com/css?family=Montserrat:700' rel='stylesheet' type='text/css'>

	
</head>

<body>
	<div class="vendingMachine">
		<div class="row r0">Coke</div>
		<div class="row r1">Diet Coke</div>
		<div class="row r2">Sprite</div>
		<div class="row r3">Diet Cherry 7up</div>
		<div class="row r4">Root Beer</div>
		<div class="row r5">Vanilla Coke</div>
		<div class="row r6">Random</div>
	</div>

	Yo username <input type="text" id ="yoUsername">
	Yo API KEY <input type="text" id ="yoAPIKEY">
	<button id="yoOneButton">Yo ONE</button>

	<script type="text/javascript">
		var myFirebaseRef = new Firebase("https://glowing-fire-3873.firebaseio.com/");
		myFirebaseRef.set({
		  Coke: {
		  	type: "Coke", yoUsername: "CUONGHOAN1103", amount: 20
		  },
		  Diet_Coke: {
		  	type:"Diet Coke",username:"YOVEND81", amount: 20
		  },
		  Sprite:{
		  	type:"Sprite",username:"YOVEND82", amount: 20
		  },
		  Diet_Cherry_7up:{
		  	type:"Diet Cherry 7up",username:"YOVEND83", amount: 20
		  },
		  Root_Beer: {
		  	type:"Root Beer",username:"YOVEND84", amount: 20
		  },
		  Vanilla_Coke: {
		  	type:"Vanilla Coke",username:"YOVEND85", amount: 20
		  }
		});


		var apiURL = 'https://api.justyo.co/';
		var yoAPIKEY = "";
		
		//getting API Keys
		$(document).click(function(){
			yoAPIKEY = $("#yoAPIKEY").val();
			console.log('document pressed: ' + yoAPIKEY)
		});	

		$(".r0").click(function(){
			var amountRemaining;
			myFirebaseRef.child("Coke").on("value", function(snapshot) {
				var info = snapshot.val();
			  console.log(info.type + " " + info.amount + " " + info.yoUsername);
			  if(info.amount > 0)   
			  	yoOrder(info.yoUsername);
			  amountRemaining = info.amount - 1;
			});
			//if successful, then subtract from total
			myFirebaseRef.child("Coke").update({
			  "amount": amountRemaining
			});
		});
		$(".r1").click(function(){
			var amountRemaining;
			myFirebaseRef.child("Diet_Coke").on("value", function(snapshot) {
				var info = snapshot.val();
			  console.log(info.type + " " + info.amount + " " + info.yoUsername);
			  if(info.amount > 0)   
			  	//yoOrder(info.yoUsername);
			  amountRemaining = info.amount - 1;
			});
			//if successful, then subtract from total
			myFirebaseRef.child("Diet_Coke").update({
			  "amount": amountRemaining
			});
		});
		$(".r2").click(function(){
			var amountRemaining;
			myFirebaseRef.child("Sprite").on("value", function(snapshot) {
				var info = snapshot.val();
			  console.log(info.type + " " + info.amount + " " + info.yoUsername);
			  if(info.amount > 0)   
			  	//yoOrder(info.yoUsername);
			  amountRemaining = info.amount - 1;
			});
			//if successful, then subtract from total
			myFirebaseRef.child("Sprite").update({
			  "amount": amountRemaining
			});
		});
		$(".r3").click(function(){
			var amountRemaining;
			myFirebaseRef.child("Diet_Cherry_7up").on("value", function(snapshot) {
				var info = snapshot.val();
			  console.log(info.type + " " + info.amount + " " + info.yoUsername);
			  if(info.amount > 0)   
			  	//yoOrder(info.yoUsername);
			  amountRemaining = info.amount - 1;
			});
			//if successful, then subtract from total
			myFirebaseRef.child("Diet_Cherry_7up").update({
			  "amount": amountRemaining
			});
		});
		$(".r4").click(function(){
			var amountRemaining;
			myFirebaseRef.child("Root_Beer").on("value", function(snapshot) {
				var info = snapshot.val();
			  console.log(info.type + " " + info.amount + " " + info.yoUsername);
			  if(info.amount > 0)   
			  	//yoOrder(info.yoUsername);
			  amountRemaining = info.amount - 1;
			});
			//if successful, then subtract from total
			myFirebaseRef.child("Root_Beer").update({
			  "amount": amountRemaining
			});
		});
		$(".r5").click(function(){
			var amountRemaining;
			myFirebaseRef.child("Vanilla_Coke").on("value", function(snapshot) {
				var info = snapshot.val();
			  console.log(info.type + " " + info.amount + " " + info.yoUsername);
			  if(info.amount > 0)   
			  	//yoOrder(info.yoUsername);
			  amountRemaining = info.amount - 1;
			});
			//if successful, then subtract from total
			myFirebaseRef.child("Vanilla_Coke").update({
			  "amount": amountRemaining
			});
		});
		$(".r6").click(function(){
			console.log("r6 Pressed");
			var value = Math.floor(Math.random()*6);
			var sodaRandom;
			console.log("random value : " + value)
			if(value === 0)
				sodaRandom = 'Coke';
			if(value === 1)
				sodaRandom = 'Diet_Coke';
			if(value === 2)
				sodaRandom = 'Sprite';
			if(value === 3)
				sodaRandom = 'Diet_Cherry_7up';
			if(value === 4)
				sodaRandom = 'Root_Beer';
			if(value === 5)
				sodaRandom = 'Vanilla_Coke';
			var amountRemaining;
			myFirebaseRef.child(sodaRandom).on("value", function(snapshot) {
				var info = snapshot.val();
			  console.log(info.type + " " + info.amount + " " + info.yoUsername);
			  if(info.amount > 0)   
			  	//yoOrder(info.yoUsername);
			  amountRemaining = info.amount - 1;
			});
			//if successful, then subtract from total
			myFirebaseRef.child(sodaRandom).update({
			  "amount": amountRemaining
			});
		});

		var yoOrder = function(yoCoke){
			//fix later so user must input API_KEY
		//	if(yoAPIKEY === "")
		//		yoAPIKEY = '963f906c-a42a-49c3-b106-806486bc38f9';
			$.ajax({
			  type: "POST",
			  url: "http://api.justyo.co/yo/",
			  data: {'api_token': yoAPIKEY, 'username': yoCoke}
			})
			.done(function succesCallback (argument) {
				console.log('success');
			})
			.fail(function failureCallback (argument) {
				console.log('failureCallback');
			});
		};

	</script>
</body>
</html>