<!DOCTYPE HTML>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
  <title>YoCokeController</title>
  <!-- rename as Yo Ordr??? -->

  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js"></script>

  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>

  <!-- Firebase -->
  <script src="https://cdn.firebase.com/js/client/2.0.4/firebase.js"></script>

  <!-- css -->
	<link rel="stylesheet" href="http://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
	<link rel="stylesheet" href="style.css">

	<!-- fonts -->
	<link href='http://fonts.googleapis.com/css?family=Montserrat:700' rel='stylesheet' type='text/css'>
</head>

<body>
	<div class="vendingMachine">
		<div class="row rHeader">YO COKE CONTROLLER</div>
		<input type="text" id="yoAPIKEY" class="row" placeholder="INPUT API KEY">
		<div class="row r0" id="n0">COKE</div>
		<div class="row r1" id="n1">DIET COKE</div>
		<div class="row r2" id="n2">SPRITE</div>
		<div class="row r3" id="n3">DIET CHERRY 7UP</div>
		<div class="row r4" id="n4">DIET DR. PEPPER</div>
		<div class="row r5" id="n5">VANILLA COKE</div>
		<div class="row r6" id="n6">RANDOM</div>
	</div>

>>>>>>> origin/master
	<script type="text/javascript">
		var myFirebaseRef = new Firebase("https://glowing-fire-3873.firebaseio.com/");
		myFirebaseRef.set({
		  Coke: {
		  	type: "Coke", yoUsername: "CUONGHOAN1103", amount: 20, access: []
		  },
		  Diet_Coke: {
		  	type:"Diet Coke",username:"YOVEND81", amount: 20, access: []
		  },
		  Sprite:{
		  	type:"Sprite",username:"YOVEND82", amount: 20, access: []
		  },
		  Diet_Cherry_7up:{
		  	type:"Diet Cherry 7up",username:"YOVEND83", amount: 20, access: []
		  },
		  Diet_Dr_Pepper: {
		  	type:"Diet Dr. Pepper",username:"YOVEND84", amount: 20, access: []
		  },
		  Vanilla_Coke: {
		  	type:"Vanilla Coke",username:"YOVEND85", amount: 20, access: []
		  }
		});


		var apiURL = 'https://api.justyo.co/';
		var yoAPIKEY = "";
		
		//getting API Keys
		$(document).click(function(){
			yoAPIKEY = $("#yoAPIKEY").val();
			console.log('document pressed: ' + yoAPIKEY)
		});	

		$(".r0").click(function(){
			var amountRemaining;
			myFirebaseRef.child("Coke").on("value", function(snapshot) {
				var info = snapshot.val();
			  console.log(info.type + " " + info.amount + " " + info.yoUsername);
			  if(info.amount > 0)   
			  	yoOrder(info.yoUsername);
			  amountRemaining = info.amount - 1;
			  document.getElementById("n0").innerHTML = "COKE : " + amountRemaining;
			});
			var time = new Date();
			console.log(time);
			//if successful, then subtract from total
			myFirebaseRef.child("Coke").update({
			  "amount": amountRemaining,
			  "access": [time]
			});
		});
		$(".r1").click(function(){
			var amountRemaining;
			myFirebaseRef.child("Diet_Coke").on("value", function(snapshot) {
				var info = snapshot.val();
			  console.log(info.type + " " + info.amount + " " + info.yoUsername);
			  if(info.amount > 0)   
			  	yoOrder(info.yoUsername);
			  amountRemaining = info.amount - 1;
			  document.getElementById("n1").innerHTML = "DIET COKE : " + amountRemaining;
			});
			//if successful, then subtract from total
			myFirebaseRef.child("Diet_Coke").update({
			  "amount": amountRemaining
			});
		});
		$(".r2").click(function(){
			var amountRemaining;
			myFirebaseRef.child("Sprite").on("value", function(snapshot) {
				var info = snapshot.val();
			  console.log(info.type + " " + info.amount + " " + info.yoUsername);
			  if(info.amount > 0)   
			  	yoOrder(info.yoUsername);
			  amountRemaining = info.amount - 1;
			  document.getElementById("n2").innerHTML = "SPRITE : " + amountRemaining;
			});
			//if successful, then subtract from total
			myFirebaseRef.child("Sprite").update({
			  "amount": amountRemaining
			});
		});
		$(".r3").click(function(){
			var amountRemaining;
			myFirebaseRef.child("Diet_Cherry_7up").on("value", function(snapshot) {
				var info = snapshot.val();
			  console.log(info.type + " " + info.amount + " " + info.yoUsername);
			  if(info.amount > 0)   
			  	yoOrder(info.yoUsername);
			  amountRemaining = info.amount - 1;
			  document.getElementById("n3").innerHTML = "DIET CHERRY 7UP : " + amountRemaining;
			});
			//if successful, then subtract from total
			myFirebaseRef.child("Diet_Cherry_7up").update({
			  "amount": amountRemaining
			});
		});
		$(".r4").click(function(){
			var amountRemaining;
			myFirebaseRef.child("Diet_Dr_Pepper").on("value", function(snapshot) {
				var info = snapshot.val();
			  console.log(info.type + " " + info.amount + " " + info.yoUsername);
			  if(info.amount > 0)   
			  	yoOrder(info.yoUsername);
			  amountRemaining = info.amount - 1;
			  document.getElementById("n4").innerHTML = "DIET DR PEPPER : " + amountRemaining;
			});
			//if successful, then subtract from total
			myFirebaseRef.child("Diet_Dr_Pepper").update({
			  "amount": amountRemaining
			});
		});
		$(".r5").click(function(){
			var amountRemaining;
			myFirebaseRef.child("Vanilla_Coke").on("value", function(snapshot) {
				var info = snapshot.val();
			  console.log(info.type + " " + info.amount + " " + info.yoUsername);
			  if(info.amount > 0)   
			  	yoOrder(info.yoUsername);
			  amountRemaining = info.amount - 1;
			  document.getElementById("n5").innerHTML = "VANILLA COKE : " + amountRemaining;
			});
			//if successful, then subtract from total
			myFirebaseRef.child("Vanilla_Coke").update({
			  "amount": amountRemaining
			});
		});
		$(".r6").click(function(){
			console.log("r6 Pressed");
			var value = Math.floor(Math.random()*6);
			var sodaRandom;
			console.log("random value : " + value)
			if(value === 0)
				sodaRandom = 'Coke';
			if(value === 1)
				sodaRandom = 'Diet_Coke';
			if(value === 2)
				sodaRandom = 'Sprite';
			if(value === 3)
				sodaRandom = 'Diet_Cherry_7up';
			if(value === 4)
				sodaRandom = 'Diet_Dr_Pepper';
			if(value === 5)
				sodaRandom = 'Vanilla_Coke';
			var amountRemaining;
			myFirebaseRef.child(sodaRandom).on("value", function(snapshot) {
				var info = snapshot.val();
			  console.log(info.type + " " + info.amount + " " + info.yoUsername);
			  if(info.amount > 0)   
			  	yoOrder(info.yoUsername);
			  amountRemaining = info.amount - 1;
			});
			//if successful, then subtract from total
			myFirebaseRef.child(sodaRandom).update({
			  "amount": amountRemaining
			});
		});

		var yoOrder = function(yoCoke){
			if(yoAPIKEY === "")
				yoAPIKEY = '963f906c-a42a-49c3-b106-806486bc38f9';
			$.ajax({
			  type: "POST",
			  url: "http://api.justyo.co/yo/",
			  data: {'api_token': yoAPIKEY, 'username': yoCoke}
			})
			.done(function succesCallback (argument) {
				console.log('success');
			})
			.fail(function failureCallback (argument) {
				console.log('failureCallback');
			});
		};

	</script>
</body>
</html>